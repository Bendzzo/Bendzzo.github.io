<!doctype html>
<html lang="sk">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Prepisovač SQL -> _sql formát</title>
  <style>
    :root {
      /* Tvoje pôvodné farby */
      --bg: #f6f8fb;
      --panel: #ffffff;
      --accent: #2b6cb0;
      --accent-hover: #1e4b7a;
      --text: #111;
      --border: #d9e2ef;
      --header-bg: #34495e; /* Farba hlavičiek panelov (tmavá ako na obrázku) */
      --header-text: #fff;
    }

    * {
      box-sizing: border-box;
      font-family: Segoe UI, Roboto, Arial, sans-serif;
    }

    body {
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Hlavný nadpis stránky */
    header {
      background: var(--accent);
      color: white;
      padding: 0 20px;
      height: 50px;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }

    h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    /* Hlavný kontajner pre 3-stĺpcové rozloženie */
    main {
      flex: 1;
      display: flex;
      padding: 10px;
      gap: 10px;
      overflow: hidden; /* Aby sa scrollovalo len vnútri editorov */
    }

    /* Ľavý a Pravý panel (Editor kontajnery) */
    .editor-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      min-width: 0; /* Pretečenie textu */
    }

    /* Hlavička editora (Input SQL / Output) */
    .panel-header {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 8px 12px;
      font-size: 13px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Samotné textarey */
    textarea {
      flex: 1;
      width: 100%;
      padding: 10px;
      font-family: Consolas, Monaco, monospace;
      font-size: 13px;
      border: none;
      resize: none; /* Rozťahovanie rieši flexbox */
      outline: none;
    }
    
    textarea:focus {
      background-color: #fcfcfc;
    }

    /* Stredný stĺpec s tlačidlami */
    .middle-controls {
      width: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
      flex-shrink: 0;
    }

    button {
      background: var(--accent);
      color: #fff;
      border: 1px solid transparent;
      padding: 12px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background 0.2s, transform 0.1s;
      width: 100%;
      text-align: center;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    button:hover {
      background: var(--accent-hover);
    }

    button:active {
      transform: translateY(1px);
    }

    button.secondary {
      background: #fff;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    button.secondary:hover {
      background: #f0f4f8;
    }

    /* Sekcia nastavení pod vstupom */
    .options-container {
      padding: 10px;
      background: #f1f5f9;
      border-top: 1px solid var(--border);
      font-size: 12px;
      overflow-y: auto;
      max-height: 200px;
    }

    .options-container label {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      cursor: pointer;
    }

    .options-container input {
      margin-right: 8px;
    }

    code {
      background: #e2e8f0;
      padding: 1px 4px;
      border-radius: 3px;
      font-family: monospace;
    }

    /* Responzivita pre mobily */
    @media (max-width: 800px) {
      main {
        flex-direction: column;
        overflow-y: auto;
      }
      .middle-controls {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
      }
      button {
        width: auto;
        flex: 1;
      }
      textarea {
        min-height: 200px;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Prepisovač SQL</h1>
  </header>

  <main>
    <!-- ĽAVÝ PANEL: VSTUP -->
    <section class="editor-panel">
      <div class="panel-header">
        <span>Vstup (SQL)</span>
        <span style="opacity: 0.7; font-weight: normal; font-size: 11px;">Input Code</span>
      </div>
      <textarea id="sqlInput" placeholder="Napíšte alebo vložte SQL sem..."></textarea>
      
      <!-- Nastavenia presunuté dole do ľavého panelu -->
      <div class="options-container">
        <strong>Nastavenia:</strong>
        <label><input type="checkbox" id="preserveIndent" checked> Zachovať odsadenie</label>
        <label><input type="checkbox" id="preserveTrailing" checked> Medzera na konci riadku</label>
        <label><input type="checkbox" id="escapeQuotes" checked> Escape úvodzoviek (" -> "")</label>
        <label><input type="checkbox" id="keepInitial" checked> Úvodné <code>_sql := ""</code></label>
        <label><input type="checkbox" id="removeSemicolon" checked> Odstrániť <code>;</code> na konci</label>
      </div>
    </section>

    <!-- STREDNÝ PANEL: TLAČIDLÁ -->
    <section class="middle-controls">
      <button id="convertBtn">Prepísať >></button>
      <button id="clearBtn" class="secondary">Vyčistiť</button>
      <div style="height: 20px;"></div> <!-- Medzera -->
      <button id="copyBtn" class="secondary">Kopírovať</button>
      <button id="downloadBtn" class="secondary">Stiahnuť</button>
    </section>

    <!-- PRAVÝ PANEL: VÝSTUP -->
    <section class="editor-panel">
      <div class="panel-header">
        <span>Výstup (_sql)</span>
        <span style="opacity: 0.7; font-weight: normal; font-size: 11px;">Output Code</span>
      </div>
      <textarea id="out" readonly placeholder="Tu sa zobrazí výsledok..."></textarea>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sqlInput = document.getElementById('sqlInput');
      const out = document.getElementById('out');
      const convertBtn = document.getElementById('convertBtn');
      const clearBtn = document.getElementById('clearBtn');
      const copyBtn = document.getElementById('copyBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const preserveIndent = document.getElementById('preserveIndent');
      const preserveTrailing = document.getElementById('preserveTrailing');
      const escapeQuotes = document.getElementById('escapeQuotes');
      const keepInitial = document.getElementById('keepInitial');
      const removeSemicolon = document.getElementById('removeSemicolon');

      function escapeDoubleQuotes(s) {
        return s.replace(/"/g, '""');
      }

      function convert() {
        const text = sqlInput.value.replace(/\r\n/g, '\n');
        const lines = text.split('\n');
        const res = [];
        if (keepInitial && keepInitial.checked) {
          res.push('_sql := ""');
        }

        for (let line of lines) {
          if (!preserveIndent.checked) {
            line = line.replace(/^\s+/, '');
          }
          // remove trailing CR/linebreaks already handled; optionally trim end
          if (!preserveTrailing.checked) {
            line = line.replace(/\s+$/, '');
          }
          if (removeSemicolon && removeSemicolon.checked) {
            line = line.replace(/;\s*$/, '');
          }

          if (escapeQuotes.checked) {
            line = escapeDoubleQuotes(line);
          }

          // if option to add trailing space is set (preserveTrailing checked), keep as-is
          // always wrap in double quotes; empty line becomes empty string
          res.push('_sql := _sql + "' + line + '" + _CRLF');
        }

        out.value = res.join('\r\n');
      }

      convertBtn.addEventListener('click', convert);
      clearBtn.addEventListener('click', () => {
        sqlInput.value = '';
        out.value = '';
        sqlInput.focus();
      });

      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(out.value);
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Skopírované!';
          setTimeout(() => copyBtn.textContent = originalText, 1500);
        } catch (e) {
          alert('Kopírovanie zlyhalo. Skopírujte ručne.');
        }
      });

      downloadBtn.addEventListener('click', () => {
        if (!out.value) return;
        const blob = new Blob([out.value], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'prepis_sql.txt';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
    });
  </script>
</body>

</html>
